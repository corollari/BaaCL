bits 16 ; tell NASM this is 16 bit code
org 0x7c00 ; tell NASM to start outputting stuff at offset 0x7c00


;ax=byte counter
;bx=tree pointer
;cx=text pointer
;dl=byte holder
;dh=shift counter

%define len 290 ;  <-- REWORK (check if it works and change const dinamically)
%define text $512

mov ax, encoded ; encoded tag should be in output/encoded.asm
mv cx, text
mv dh, $7
mov bh, 0x7C

	; while(ax<len(encoded)):
startloop:
	cmp ax,len+encoded
	jge display		; Check if the order used in cmp is correct (jump if ax>=len), display tag should be in display.asm
        mov bx,root
innerloop:
	cmp dh, $7
	jne shift
                        mov dl,[ax]
                        inc ax
                        mov dh, $0
			jmp aftershift
	shift:
                        shr dl, $1
                        inc dh
	aftershift:

;bx=[bx+dx&&1]

	and dl, $1
	jnz else
		and [bx+2], ~1
		mov bl, [bx]
		jmp afterelse
	else:
		and [bx+2], ~2
		mov bl, [bx+1]
	afterelse:
		jnz innerloop
		mov [cx],bx
		inc cx
		jmp startloop
ha325d2b1c02a0f957b78702a10d8cf29819c2bb6ed7202953015368b017c5f84: db 84,87,0
haee113e45013ead0358fc94dd2097a183d61be724ee420e4f33145bb52a2dd6a: db 106,120,0
h4e58f20052265b3a9b54fb824ac2397d8ba11b5a4cc00d42171334e79f822240: db ha325d2b1c02a0f957b78702a10d8cf29819c2bb6ed7202953015368b017c5f84,haee113e45013ead0358fc94dd2097a183d61be724ee420e4f33145bb52a2dd6a
hddbd1fa56af303f7fcd87f0fbe23f091b16ef5c6fab517078fe5848a0df53eae: db h4e58f20052265b3a9b54fb824ac2397d8ba11b5a4cc00d42171334e79f822240,46,2
ha27f13ef6aec375afa1f1c0f250cf368a92825ec130eb749f521714f182b0507: db 115,hddbd1fa56af303f7fcd87f0fbe23f091b16ef5c6fab517078fe5848a0df53eae,1
h13a4f6de458197c3d73d7280e506a4de8b2bd3b7637404c9cf036e102699dd53: db ha27f13ef6aec375afa1f1c0f250cf368a92825ec130eb749f521714f182b0507,97,2
h2008b735f2a32c4d4971cb5f337a4301063e5966c9d36d6d3ee8bf9d5dfde8cb: db 105,116,0
he428a006d1196a5a792c4e978e3c03b1f2c7050dcd88e0f3b734f2c742ebc7f1: db h13a4f6de458197c3d73d7280e506a4de8b2bd3b7637404c9cf036e102699dd53,h2008b735f2a32c4d4971cb5f337a4301063e5966c9d36d6d3ee8bf9d5dfde8cb
h88bb68ef24d5ef27b739d888781c2f521cde999624b83849985f5221cc147eb7: db 99,108,0
hd249d67e9af20ff53b84a42efb185aed721426f5d16de0083cc18dfd5d44160c: db 65,112,0
he632b486eec3f2eb355aa549c100981d3c4a29db12f69632beb90f70bea38863: db 117,hd249d67e9af20ff53b84a42efb185aed721426f5d16de0083cc18dfd5d44160c,1
h3c90f3229e6e55f1e615877a419631ba3eab1abe5f9f2006a25707dc922b2b1f: db h88bb68ef24d5ef27b739d888781c2f521cde999624b83849985f5221cc147eb7,he632b486eec3f2eb355aa549c100981d3c4a29db12f69632beb90f70bea38863
h161652878e6276f6524f339828c9ce54d35f04e3f4d1c3e7d632248697bb715d: db 110,101,0
hb69aa241e465e55a89bc9e10ec8a0d206c34bb42d21423581e24666064c7dd42: db h3c90f3229e6e55f1e615877a419631ba3eab1abe5f9f2006a25707dc922b2b1f,h161652878e6276f6524f339828c9ce54d35f04e3f4d1c3e7d632248697bb715d
h0a702f52b86abc15f67b342e78c9300cbec91bd42a2c4fc4d93504c554a066de: db he428a006d1196a5a792c4e978e3c03b1f2c7050dcd88e0f3b734f2c742ebc7f1,hb69aa241e465e55a89bc9e10ec8a0d206c34bb42d21423581e24666064c7dd42
hba60a05324e37884704580e5a1bb4babe0dd0f947164ec11962e7f8aa61898b1: db 45,98,0
h74ffd4af197773f08ffdb110842cd5d603a3cc5faee1b108a2a5d6a1e37c03ce: db 100,102,0
h3309b4015dab5ac1c8c30c5e2d9931f673c32c0a2af1d9230acc4bd8482a4191: db hba60a05324e37884704580e5a1bb4babe0dd0f947164ec11962e7f8aa61898b1,h74ffd4af197773f08ffdb110842cd5d603a3cc5faee1b108a2a5d6a1e37c03ce
h0993c31c99098c26f361a32d5ff58a04f305e3cb9a4a2e846a04859fdba04241: db 114,h3309b4015dab5ac1c8c30c5e2d9931f673c32c0a2af1d9230acc4bd8482a4191,1
ha4447899e129e64ded75cd3da1b3341bbd467fd03d3ab96a697471ec68291c36: db 83,121,0
hf74aeb9816bc388428dbbf00f04dd081f97e24d7277c89d3f300086648494c03: db ha4447899e129e64ded75cd3da1b3341bbd467fd03d3ab96a697471ec68291c36,103,2
hd60967806d802e03bbc53ea7fc6c89ef8989e4c914f7cd0c34227d170c67670c: db 109,10,0
h8dedc3c67460a81df6ce77311668a7b61decb3256f5664d6e271750d92535c21: db hf74aeb9816bc388428dbbf00f04dd081f97e24d7277c89d3f300086648494c03,hd60967806d802e03bbc53ea7fc6c89ef8989e4c914f7cd0c34227d170c67670c
hd3b895ec5b03f807e4263352c8583efbc832cb7df7e1bf6b09c0206bd7b90af7: db 111,h8dedc3c67460a81df6ce77311668a7b61decb3256f5664d6e271750d92535c21,1
h30192adaf896845d34a0dda871bb72557c8691d581db79ed5ec4137c3f7acea3: db h0993c31c99098c26f361a32d5ff58a04f305e3cb9a4a2e846a04859fdba04241,hd3b895ec5b03f807e4263352c8583efbc832cb7df7e1bf6b09c0206bd7b90af7
h04e4a30a0f049f84b84e1c97a6bf415e9ec7c862ad1c6d484a6ba88095c58798: db 13,104,0
h2a9bc42abbb7a7640b5e4c6323378d7ee9d87f3e1f46100c8d9896f4f4376693: db 51,67,0
h1f74494f923e9bf4bedc9968f0418824c2b298bd83009812a45e547f6733ac7b: db 41,40,0
h8863da317bd9233d182a06414af98b233ff1d51ab716aecbe07f4b7e58efbd58: db 107,h1f74494f923e9bf4bedc9968f0418824c2b298bd83009812a45e547f6733ac7b,1
h3b39b8565466c7e9379d3b10d2b74d02aa654f09072bfb98e94fdf24b3de6435: db h2a9bc42abbb7a7640b5e4c6323378d7ee9d87f3e1f46100c8d9896f4f4376693,h8863da317bd9233d182a06414af98b233ff1d51ab716aecbe07f4b7e58efbd58
h7fc3cd969db3c827844aff0a48db3aa2b0f003472ef635aaea449a39c71cd8cf: db h04e4a30a0f049f84b84e1c97a6bf415e9ec7c862ad1c6d484a6ba88095c58798,h3b39b8565466c7e9379d3b10d2b74d02aa654f09072bfb98e94fdf24b3de6435
ha5c718889eb455929d336f9e751c4524554dbf3729f7e609cad6d57e3db8c663: db 44,47,0
hecd8409a7716ba7f20b5ed1c68de689a94636675972d07e0cb1e0c8099e392d1: db 49,52,0
h40dfafef6dd3954b838475433f1ca45b5261a4ab895ef5174c4b8e2a0cfc84a6: db ha5c718889eb455929d336f9e751c4524554dbf3729f7e609cad6d57e3db8c663,hecd8409a7716ba7f20b5ed1c68de689a94636675972d07e0cb1e0c8099e392d1
hd283fc7ed27a618f0d8e673ffbd01c18ba8d472f095f375f93576d3ed40c4782: db 56,58,0
h82d2cacdab9235927203189d1b5311dc6d4d2238630158b42fb8278327571482: db 64,71,0
h284ce7e5ee454526a70ffa13fd961042388db1bd8582aadaef2e82fc8124ec43: db hd283fc7ed27a618f0d8e673ffbd01c18ba8d472f095f375f93576d3ed40c4782,h82d2cacdab9235927203189d1b5311dc6d4d2238630158b42fb8278327571482
hae9b0c16ca558f66a0934a60bd162f61da85a21f08246ed5d39313d5c4c4d726: db h40dfafef6dd3954b838475433f1ca45b5261a4ab895ef5174c4b8e2a0cfc84a6,h284ce7e5ee454526a70ffa13fd961042388db1bd8582aadaef2e82fc8124ec43
h6d93bc61c73d0cfe257aa4054b15b586c9b92f232e0518a5ee76352059628629: db 73,80,0
h2a5f03ab4dc52c455d0a336a7dacdef3cf39faf519b4de2ad8b8595d663a9c43: db 39,43,0
h3a02272d22c72d21facc860849c47479f9153d3f116d482fa88e71c507bbf755: db 119,h2a5f03ab4dc52c455d0a336a7dacdef3cf39faf519b4de2ad8b8595d663a9c43,1
h0713211f7fb7ab573349361b11fb0efe4568ba51ff1601d6086cee89af1bcb92: db h6d93bc61c73d0cfe257aa4054b15b586c9b92f232e0518a5ee76352059628629,h3a02272d22c72d21facc860849c47479f9153d3f116d482fa88e71c507bbf755
hfb420d1701eecd8f951f3834671277144b3287908bf698f5c0ef2fdacd6eb655: db 48,53,0
hee1de4914cc26e8f1326b49793b089131870d478714c07e0c99c56cb307704c5: db 55,54,0
h25071bad1f48f63a8027e8e72bd161b524613ef00c1cb73bf0c96fcda7eb9dfc: db hfb420d1701eecd8f951f3834671277144b3287908bf698f5c0ef2fdacd6eb655,hee1de4914cc26e8f1326b49793b089131870d478714c07e0c99c56cb307704c5
h1246892ef4ec21379a82257e2c33bf86177b864c86ef44e49e861d0169425633: db 57,72,0
hf7f2a37e8616fbe9925cfb7dffa53691c8d1c31dfa78d94c10078fdc4d25309d: db 77,79,0
he476bcb5b60251b6c023a09fcacff5b6fa75d35046d944508ff96c4ff37f7e24: db h1246892ef4ec21379a82257e2c33bf86177b864c86ef44e49e861d0169425633,hf7f2a37e8616fbe9925cfb7dffa53691c8d1c31dfa78d94c10078fdc4d25309d
h0378fec4cc6f00daf94dbdd7af0408c1d00566762bd59996f38b556e88930572: db h25071bad1f48f63a8027e8e72bd161b524613ef00c1cb73bf0c96fcda7eb9dfc,he476bcb5b60251b6c023a09fcacff5b6fa75d35046d944508ff96c4ff37f7e24
h98a109580b5bf7d177737bf47db187a388371a68ce7cdf0373e32de07556ecf3: db h0713211f7fb7ab573349361b11fb0efe4568ba51ff1601d6086cee89af1bcb92,h0378fec4cc6f00daf94dbdd7af0408c1d00566762bd59996f38b556e88930572
h25b6719e49817490411c37bcc4a879a3925ea794b7a0c6e3a092f151054c240a: db hae9b0c16ca558f66a0934a60bd162f61da85a21f08246ed5d39313d5c4c4d726,h98a109580b5bf7d177737bf47db187a388371a68ce7cdf0373e32de07556ecf3
hb47c09681620b99025769336f007290bd66ee3a77580b04042a383263aa146d9: db h7fc3cd969db3c827844aff0a48db3aa2b0f003472ef635aaea449a39c71cd8cf,h25b6719e49817490411c37bcc4a879a3925ea794b7a0c6e3a092f151054c240a
hb1dccb5a1266aefdc1bf02c02dde672990320b4c2f493ef115a393df25eb8acc: db 32,hb47c09681620b99025769336f007290bd66ee3a77580b04042a383263aa146d9,1
hf930f66994be17b9c52ddab8371c05c3da6d73ff2ae144921e857d333357b239: db h30192adaf896845d34a0dda871bb72557c8691d581db79ed5ec4137c3f7acea3,hb1dccb5a1266aefdc1bf02c02dde672990320b4c2f493ef115a393df25eb8acc
root: db h0a702f52b86abc15f67b342e78c9300cbec91bd42a2c4fc4d93504c554a066de,hf930f66994be17b9c52ddab8371c05c3da6d73ff2ae144921e857d333357b239
display:
    mov si,text ; point si register to hello label memory location
    mov ah,0x0e ; 0x0e means 'Write Character in TTY mode'
.loop:
    lodsb
    or al,al ; is al == 0 ?
    jz halt  ; if (al == 0) jump to halt label
    int 0x10 ; runs BIOS interrupt 0x10 - Video Services
    jmp .loop
halt:
    cli ; clear interrupt flag
    hlt ; halt execution

encoded: db 0x,7c,7d,ae,cb,26,57,83,cb,21,e5,8a,6f,5b,f8,93,58,35,4c,ec,7a,e1,0a,a8,26,b7,13,6f,f0,9f,3e,1b,ad,8c,2d,36,08,74,ba,2a,eb,94,c4,81,32,a6,06,fa,23,e7,0e,42,a2,1d,8f,7b,fc,ad,aa,7d,fc,0f,a7,8f,97,e3,77,9d,2f,bd,fe,56,c4,d9,da,d2,67,78,26,b7,24,40,7a,cb,8c,77,5f,c4,9b,ad,49,3d,29,a6,78,d5,3e,1d,38,92,5e,6c,b7,c6,01,8c,1a,97,bf,89,35,87,82,14,ee,45,1d,84,f9,a6,d6,d3,c6,ef,09,2e,c4,bb,cc,43,e1,a8,2e,7a,89,bf,a2,8e,c0,0c,30,fb,af,e2,4d,ff,5d,db,02,95,08,7c,8a,63,82,95,47,51,be,b9,ad,6d,38,34,b6,77,b2,2a,29,29,18,2d,4d,ad,23,e5,52,df,c4,9b,aa,a2,1d,8d,36,72,6a,bb,13,5b,a7,a8,c3,80,ab,ae,78,c4,c6,f0,c0,e4,97,bf,8b,f8,eb,4c,62,83,f5,d7,3f,b0,a6,57,83,0c,1c,ef,1d,f7,e9,e7,bf,7e,9e,7b,a7,e7,79,74,de,9f,ab,f8,Ltimes 510 - ($-$$) db 0 ; pad remaining 510 bytes with zeroes
dw 0xaa55 ; magic bootloader magic - marks this 512 byte sector bootable!
